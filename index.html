<!DOCTYPE html><html><head><title>War Castle</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>body{margin:0;background:#1a1a1a;color:#fff;font-family:sans-serif;overflow:hidden;touch-action:none}#game-container{width:100vw;height:100vh;overflow-y:auto;overflow-x:hidden;position:relative;scrollbar-width:none}#game-container::-webkit-scrollbar{display:none}canvas{display:block;background:#355e3b}#ui{position:fixed;bottom:10px;left:0;width:100%;display:flex;justify-content:center;gap:6px;z-index:10}.shop-item{background:rgba(30,30,30,.95);border:2px solid #44f;width:55px;height:65px;text-align:center;border-radius:8px;display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,.5);transition:.2s}.shop-item.active{border-color:#f0f;background:rgba(80,0,80,.8);transform:scale(1.1)}.item-icon{font-size:20px}.item-cost{color:#ffd700;font-weight:700;font-size:10px;margin-top:2px}.stats{position:fixed;top:5px;width:100%;display:flex;justify-content:space-between;padding:0 10px;box-sizing:border-box;z-index:10;pointer-events:none}.stat-card{background:rgba(0,0,0,.7);padding:6px 12px;border-radius:8px;font-size:11px;border-left:4px solid #44f;backdrop-filter:blur(4px)}.red-side{border-left:0;border-right:4px solid #f44;text-align:right}#drag-icon{position:fixed;width:35px;height:35px;background:rgba(0,0,255,.3);border:2px solid #fff;display:none;pointer-events:none;transform:translate(-50%,-50%);z-index:100;font-size:20px;text-align:center;line-height:35px}#drag-icon.wall-drag{width:80px;height:15px}</style></head><body>
<div class="stats"><div class="stat-card">ğŸ’°<span id="gold1">0</span>|ğŸ° <span id="hp1">500</span><br>ğŸ’ <span id="mines1">0</span>/3|âš”ï¸ <span id="bld1">0</span>/25</div><div class="stat-card red-side">ğŸ° <span id="hp2">500</span>|ğŸ’°<span id="gold2">0</span><br>25/<span id="bld2">0</span> :âš”ï¸|3/<span id="mines2">0</span> :ğŸ’</div></div>
<div id="ui"><div class="shop-item" ontouchstart="startDrag('barracks',50)"><div class="item-icon">ğŸ </div><div class="item-cost">50</div></div><div class="shop-item" ontouchstart="startDrag('archers',150)"><div class="item-icon">ğŸ¹</div><div class="item-cost">150</div></div><div class="shop-item" ontouchstart="startDrag('wall',200)"><div class="item-icon">ğŸ§±</div><div class="item-cost">200</div></div><div class="shop-item" ontouchstart="startDrag('turret',70)"><div class="item-icon">ğŸ›¡ï¸</div><div class="item-cost">70</div></div><div class="shop-item" ontouchstart="startDrag('bomb',200)"><div class="item-icon">ğŸ’£</div><div class="item-cost">200</div></div><div class="shop-item" ontouchstart="startDrag('mine',100)"><div class="item-icon">ğŸ’</div><div class="item-cost" id="mine-cost-ui">100</div></div><div class="shop-item" id="sell-btn" onclick="toggleSellMode()"><div class="item-icon">ğŸ’°âœ–ï¸</div><div class="item-cost">Sell</div></div></div>
<div id="drag-icon"></div><div id="game-container" onclick="handleCanvasClick(event)"><canvas id="gameCanvas"></canvas></div>
<script>
const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),dragIcon=document.getElementById("drag-icon"),container=document.getElementById("game-container");
let sellMode=!1,gameState={p1:{gold:100,hp:500,income:3,mines:0,bombs:0,combatBuildings:0,barracks:0,archerHouses:0,turrets:0},p2:{gold:100,hp:500,income:3,mines:0,bombs:0,combatBuildings:0,barracks:0,archerHouses:0,turrets:0},units:[],buildings:[],projectiles:[],vfx:[]};
function getMineCost(m){return 100+m*100}
function toggleSellMode(){sellMode=!sellMode;document.getElementById('sell-btn').classList.toggle('active',sellMode)}
function destroyBuilding(i){let b=gameState.buildings[i],p=b.player===1?gameState.p1:gameState.p2;if(b.type==='mine'){p.income-=4;p.mines--}else{if(b.type==='bomb')p.bombs--;else if(b.type==='barracks')p.barracks--;else if(b.type==='archers')p.archerHouses--;else if(b.type!=='wall')p.turrets--;p.combatBuildings--}gameState.buildings.splice(i,1)}
function handleCanvasClick(e){if(!sellMode)return;const r=canvas.getBoundingClientRect(),cX=e.clientX-r.left,cY=e.clientY-r.top+container.scrollTop;const i=gameState.buildings.findIndex(b=>b.player===1&&Math.abs(b.x+(b.type==='wall'?40:20)-cX)<(b.type==='wall'?45:25)&&Math.abs(b.y+(b.type==='wall'?7:20)-cY)<25);if(i!==-1){let b=gameState.buildings[i],ref=b.type==='mine'?getMineCost(gameState.p1.mines-1)/2:(b.type==='bomb'?100:(b.type==='turret'?35:25));gameState.p1.gold+=ref;destroyBuilding(i)}}
const decorations=[];for(let i=0;i<40;i++)decorations.push({x:Math.random()*400,y:Math.random()*1000,size:2+Math.random()*5,type:Math.random()>.5?'stone':'grass'});
function resize(){canvas.width=innerWidth;canvas.height=innerHeight*2.5}
window.onresize=resize;resize();setTimeout(()=>container.scrollTop=canvas.height,200);
let dragging=null;function startDrag(t,c){sellMode=!1;document.getElementById('sell-btn').classList.remove('active');let cost=t==='mine'?getMineCost(gameState.p1.mines):c;if(gameState.p1.gold>=cost){if(t==='mine'&&gameState.p1.mines>=3)return;if(t!=='mine'&&gameState.p1.combatBuildings>=25)return;dragging={t,c:cost};dragIcon.style.display="block";dragIcon.className=t==='wall'?'wall-drag':'';dragIcon.innerHTML=t==='wall'?'':(t==='barracks'?'ğŸ ':(t==='archers'?'ğŸ¹':(t==='mine'?'ğŸ’':(t==='bomb'?'ğŸ’£':'ğŸ›¡ï¸'))))}}
window.ontouchmove=e=>{if(dragging){dragIcon.style.left=e.touches[0].clientX+"px";dragIcon.style.top=e.touches[0].clientY+"px"}};
window.ontouchend=e=>{if(!dragging)return;let t=e.changedTouches[0],cY=t.clientY+container.scrollTop,cX=t.clientX,w=dragging.t==='wall'?80:40,h=dragging.t==='wall'?15:40;let isOcc=gameState.buildings.some(b=>{let bw=b.type==='wall'?80:40,bh=b.type==='wall'?15:40;return !(cX-w/2+w<b.x||cX-w/2>b.x+bw||cY-h/2+h<b.y||cY-h/2>b.y+bh)});if(cY>canvas.height/2&&cY<canvas.height-70&&!isOcc){gameState.p1.gold-=dragging.c;if(dragging.t==='mine'){gameState.p1.income+=4;gameState.p1.mines++}else{if(dragging.t==='bomb')gameState.p1.bombs++;else if(dragging.t==='barracks')gameState.p1.barracks++;else if(dragging.t==='archers')gameState.p1.archerHouses++;else if(dragging.t!=='wall')gameState.p1.turrets++;gameState.p1.combatBuildings++}let hp=dragging.t==='wall'?900:(dragging.t==='turret'||dragging.t==='bomb'?550:350);gameState.buildings.push({type:dragging.t,player:1,x:cX-w/2,y:cY-h/2,hp,maxHp:hp,lastSpawn:0,lastShot:0})}dragging=null;dragIcon.style.display="none"};
function runAI(){let p2=gameState.p2,th=gameState.units.filter(u=>u.player===1&&u.y<canvas.height*.45).length,wls=gameState.buildings.filter(b=>b.player===2&&b.type==='wall').length,def=p2.turrets+(p2.bombs*2),type=null;if(th>=3&&wls<3&&p2.gold>=200)type='wall';else if(p2.mines<3&&p2.gold>=getMineCost(p2.mines))type='mine';else if(th>0&&def<6&&p2.gold>=70)type=(p2.gold>=200&&p2.bombs<2)?'bomb':'turret';else if(p2.combatBuildings<25&&p2.gold>=50)type=(p2.archerHouses<p2.barracks/2)?'archers':'barracks';if(type){let c=type==='wall'?200:(type==='mine'?getMineCost(p2.mines):(type==='bomb'?200:(type==='turret'?70:50))),x=30+Math.random()*(canvas.width-100),y=type==='mine'?70+Math.random()*80:(type==='wall'?380+Math.random()*30:(type==='barracks'||type==='archers'?160+Math.random()*100:250+Math.random()*80));if(!gameState.buildings.some(b=>Math.abs(b.x-x)<60&&Math.abs(b.y-y)<45)){p2.gold-=c;if(type==='mine'){p2.income+=4;p2.mines++}else{if(type==='bomb')p2.bombs++;else if(type==='barracks')p2.barracks++;else if(type==='archers')p2.archerHouses++;else if(type!=='wall')p2.turrets++;p2.combatBuildings++}let hp=type==='wall'?900:550;gameState.buildings.push({type,player:2,x,y,hp,maxHp:hp,lastSpawn:Date.now(),lastShot:0})}}}
setInterval(runAI,1200);
function update(){gameState.p1.gold+=gameState.p1.income/60;gameState.p2.gold+=gameState.p2.income/60;document.getElementById("gold1").innerText=Math.floor(gameState.p1.gold);document.getElementById("gold2").innerText=Math.floor(gameState.p2.gold);document.getElementById("hp1").innerText=Math.floor(gameState.p1.hp);document.getElementById("hp2").innerText=Math.floor(gameState.p2.hp);document.getElementById("mines1").innerText=gameState.p1.mines;document.getElementById("bld1").innerText=gameState.p1.combatBuildings;let nmc=getMineCost(gameState.p1.mines);document.getElementById("mine-cost-ui").innerText=gameState.p1.mines>=3?"MAX":nmc;gameState.vfx=gameState.vfx.filter(v=>Date.now()-v.time<500);gameState.buildings.forEach((b,i)=>{if((b.type==='barracks'||b.type==='archers')&&Date.now()-b.lastSpawn>(b.type==='archers'?5000:6000)){gameState.units.push({player:b.player,type:b.type==='archers'?'archer':'knight',x:b.x+20,y:b.y+20,hp:100,maxHp:100,speed:b.player===1?-.8:.8,lastShot:0});b.lastSpawn=Date.now()}if((b.type==='turret'||b.type==='bomb')&&Date.now()-b.lastShot>(b.type==='bomb'?3800:1500)){let t=gameState.units.find(u=>u.player!==b.player&&Math.hypot(u.x-(b.x+20),u.y-(b.y+20))<260);if(t){gameState.projectiles.push({x:b.x+20,y:b.y+20,target:t,type:b.type,player:b.player});b.lastShot=Date.now()}}if(b.hp<=0)destroyBuilding(i)});gameState.projectiles.forEach((p,i)=>{let dx=p.target.x-p.x,dy=p.target.y-p.y,d=Math.hypot(dx,dy);if(d<8){if(p.type==='bomb'){gameState.vfx.push({x:p.x,y:p.y,time:Date.now()});gameState.units.forEach(u=>{if(u.player!==p.player&&Math.hypot(u.x-p.x,u.y-p.y)<85)u.hp-=70})}else p.target.hp-=(p.type==='arrow'?25:35);gameState.projectiles.splice(i,1)}else{p.x+=dx/d*7;p.y+=dy/d*7}});gameState.units.forEach((u,i)=>{let target=null,minD=160;gameState.buildings.forEach(eb=>{if(eb.player!==u.player){let bw=eb.type==='wall'?80:40,bh=eb.type==='wall'?15:40,d=Math.hypot(eb.x+bw/2-u.x,eb.y+bh/2-u.y);if(d<minD){minD=d;target=eb;target.isB=true}}});gameState.units.forEach(eu=>{if(eu.player!==u.player){let d=Math.hypot(eu.x-u.x,eu.y-u.y);if(d<minD){minD=d;target=eu;target.isB=false}}});if(target){if(minD<(u.type==='archer'?140:35)){if(u.type==='archer'){if(Date.now()-u.lastShot>1500){gameState.projectiles.push({x:u.x,y:u.y,target,type:'arrow',player:u.player});u.lastShot=Date.now()}}else target.hp-=1.3}else{let tw=target.isB?(target.type==='wall'?80:40):0,th=target.isB?(target.type==='wall'?15:40):0,a=Math.atan2((target.y+th/2)-u.y,(target.x+tw/2)-u.x);u.x+=Math.cos(a)*.9;u.y+=Math.sin(a)*.9}}else u.y+=u.speed;if(u.y<50&&u.player===1){gameState.p2.hp-=50;u.hp=0}if(u.y>canvas.height-50&&u.player===2){gameState.p1.hp-=50;u.hp=0}if(u.hp<=0)gameState.units.splice(i,1)});draw();requestAnimationFrame(update)}
function drawB(b){let c=b.player===1?"#3b44cc":"#cc3b3b";ctx.strokeStyle="#fff";ctx.lineWidth=2;if(b.type==='barracks'||b.type==='archers'){ctx.fillStyle=c;ctx.beginPath();ctx.moveTo(b.x,b.y+40);ctx.lineTo(b.x,b.y+15);ctx.lineTo(b.x+20,b.y);ctx.lineTo(b.x+40,b.y+15);ctx.lineTo(b.x+40,b.y+40);ctx.closePath();ctx.fill();ctx.stroke();ctx.fillStyle="#fff";ctx.font="9px Arial";ctx.fillText(b.type==='archers'?"ARCH":"KNIGHT",b.x+5,b.y+30)}else if(b.type==='wall'){ctx.fillStyle=c;ctx.fillRect(b.x,b.y,80,15);ctx.strokeRect(b.x,b.y,80,15);ctx.strokeStyle="rgba(255,255,255,0.4)";for(let j=1;j<8;j++){ctx.beginPath();ctx.moveTo(b.x+j*10,b.y);ctx.lineTo(b.x+j*10,b.y+15);ctx.stroke()}}else if(b.type==='turret'){ctx.fillStyle="#555";ctx.fillRect(b.x+5,b.y+25,30,15);ctx.fillStyle=c;ctx.beginPath();ctx.arc(b.x+20,b.y+15,15,0,7);ctx.fill();ctx.stroke();ctx.fillStyle="#000";ctx.fillRect(b.x+17,b.y-5,6,12)}else if(b.type==='bomb'){ctx.fillStyle="#333";ctx.fillRect(b.x,b.y+20,40,20);ctx.fillStyle=c;ctx.fillRect(b.x+5,b.y+5,30,20);ctx.strokeRect(b.x+5,b.y+5,30,20);ctx.fillStyle="#111";ctx.fillRect(b.x+15,b.y-10,10,20)}else if(b.type==='mine'){ctx.fillStyle="#ffd700";ctx.beginPath();ctx.moveTo(b.x+20,b.y);ctx.lineTo(b.x+40,b.y+20);ctx.lineTo(b.x+20,b.y+40);ctx.lineTo(b.x,b.y+20);ctx.closePath();ctx.fill();ctx.stroke()}let bw=b.type==='wall'?80:40;ctx.fillStyle="#000";ctx.fillRect(b.x,b.y-12,bw,5);ctx.fillStyle="#0f0";ctx.fillRect(b.x,b.y-12,bw*(b.hp/b.maxHp),5)}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#355e3b";ctx.fillRect(0,0,canvas.width,canvas.height);decorations.forEach(d=>{ctx.fillStyle=d.type==='stone'?"#777":"#2d4d31";ctx.beginPath();ctx.arc(d.x,d.y,d.size,0,7);ctx.fill()});ctx.fillStyle="rgba(255,255,255,0.1)";ctx.setLineDash([20,10]);ctx.beginPath();ctx.moveTo(0,canvas.height/2);ctx.lineTo(canvas.width,canvas.height/2);ctx.stroke();ctx.setLineDash([]);ctx.fillStyle="#f44";ctx.fillRect(0,0,canvas.width,60);ctx.fillStyle="#44f";ctx.fillRect(0,canvas.height-60,canvas.width,60);gameState.buildings.forEach(drawB);gameState.units.forEach(u=>{ctx.fillStyle=u.player===1?"#44f":"#f44";ctx.beginPath();if(u.type==='archer'){ctx.moveTo(u.x,u.y-12);ctx.lineTo(u.x+10,u.y+8);ctx.lineTo(u.x-10,u.y+8)}else ctx.arc(u.x,u.y,12,0,7);ctx.fill();ctx.stroke();ctx.fillStyle="#000";ctx.fillRect(u.x-15,u.y-22,30,4);ctx.fillStyle="#0f0";ctx.fillRect(u.x-15,u.y-22,30*(u.hp/u.maxHp),4)});gameState.projectiles.forEach(p=>{ctx.fillStyle=p.type==='bomb'?"#ff0":(p.type==='arrow'?"#fff":"#fa0");ctx.beginPath();ctx.arc(p.x,p.y,p.type==='bomb'?8:4,0,7);ctx.fill()});gameState.vfx.forEach(v=>{ctx.fillStyle="rgba(255,100,0,0.3)";ctx.beginPath();ctx.arc(v.x,v.y,85,0,7);ctx.fill()})}update();
</script></body></html>
